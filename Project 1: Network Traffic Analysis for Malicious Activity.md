# Network Traffic Analysis for Malicious Activity

## Introduction
Network traffic analysis is a crucial component of threat hunting, aimed at identifying malicious activities within network traffic. By analyzing packet data, you can detect unauthorized access, malware communication, and other suspicious behavior. This project will guide you through using tools like Wireshark and Suricata to capture and analyze network traffic for potential threats.

## Pre-requisites
- Basic understanding of networking concepts (TCP/IP, DNS, HTTP, etc.).
- Familiarity with network security principles.
- Basic knowledge of command-line operations.
- Knowledge of Wireshark and Suricata.

## Lab Set-up
1. Operating System: A Linux virtual machine (Ubuntu is recommended) or a dedicated analysis machine.
2. Tools:
  - Wireshark: For packet capture and analysis.
  - Suricata: An open-source network threat detection engine.
  - PCAP Files: Sample PCAP files containing network traffic (can be obtained from repositories like Malware-Traffic-Analysis.net).
  - Virtual Network: Set up using VirtualBox or VMware for capturing live traffic if needed.

# Exercises

## Exercise 1: Capturing Network Traffic with Wireshark

Objective: Capture live network traffic and save it for analysis.

Step 1: Install Wireshark:
```
sudo apt-get update
sudo apt-get install wireshark
```
Capture Traffic:
Open Wireshark and select the network interface to capture traffic.
Start the capture and let it run for a few minutes.
Save the captured traffic to a file (e.g., capture.pcap).
Solution:
After capturing the traffic, you should have a capture.pcap file containing various network packets. This file will be used in subsequent exercises.

Exercise 2: Analyzing Basic Traffic in Wireshark

Objective: Analyze the captured traffic to identify any initial signs of malicious activity.

Steps:

Open the Capture File: Open capture.pcap in Wireshark.
Filter Traffic: Use filters to isolate specific types of traffic (e.g., http, dns, tcp.port==80).
Inspect Packets:
Look for unusual traffic patterns or repeated connections to unknown IP addresses.
Identify any suspicious payloads or unexpected data transfers.
Solution:
In Wireshark, you might find:

HTTP requests to suspicious domains.
DNS queries to known malicious domains.
Repeated connection attempts to an external IP.
Exercise 3: Using Suricata for Intrusion Detection

Objective: Set up Suricata to analyze network traffic and detect potential threats.

Steps:

Install Suricata:
shell
Copy code
sudo apt-get update
sudo apt-get install suricata
Configure Suricata:
Edit the Suricata configuration file (usually located at /etc/suricata/suricata.yaml).
Ensure the correct network interface is specified for monitoring.
Run Suricata:
shell
Copy code
sudo suricata -c /etc/suricata/suricata.yaml -i <interface>
Analyze Alerts:
Review the alerts generated by Suricata (usually stored in /var/log/suricata/fast.log or /var/log/suricata/alerts.json).
Solution:
Suricata might detect various threats such as:

Known malicious IPs (based on threat intelligence feeds).
Suspicious HTTP requests or unusual protocols.
Potential indicators of compromise (IoCs) like known attack signatures.
Exercise 4: Correlating Wireshark and Suricata Data

Objective: Combine insights from Wireshark and Suricata to validate and enrich your findings.

Steps:

Compare Findings: Cross-reference Suricata alerts with Wireshark captures.
Detailed Analysis: Use Wireshark to drill down into packets flagged by Suricata.
Contextual Investigation:
Investigate the full communication flow of suspicious IPs or domains.
Identify any follow-up actions or secondary payloads.
Solution:
For instance, if Suricata flagged an IP for C2 (Command and Control) traffic, use Wireshark to trace all communications involving that IP. Look for patterns like regular intervals of data transfer, encrypted payloads, or suspicious HTTP headers.

Exercise 5: Creating Custom Suricata Rules

Objective: Write and deploy custom Suricata rules to detect specific threats.

Steps:

Understand Rule Syntax: Review the basics of Suricata rule syntax.
Create a Rule: Write a rule to detect a specific pattern or IoC.
Example rule to detect HTTP requests to a known malicious domain:
shell
Copy code
alert http any any -> any any (msg:"Suspicious HTTP Request"; content:"malicious-domain.com"; http_host; sid:100001;)
Deploy the Rule:
Save the rule to the Suricata rules directory (e.g., /etc/suricata/rules/local.rules).
Update the Suricata configuration to include the new rule file.
Test the Rule:
Run Suricata and generate traffic that should trigger the rule.
Verify that the alert appears in the logs.
Solution:
After deploying the custom rule and generating traffic, you should see alerts in Suricata logs indicating that the rule successfully detected the malicious domain.

By completing these exercises, you'll develop skills in network traffic analysis, understand how to use both Wireshark and Suricata for threat hunting, and learn to create custom detection rules to enhance your network security posture.
